{% load static %}

<!doctype html>
<html lang="fa-IR" dir="rtl">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <link rel="stylesheet" href="{% static 'css/fonts.css' %}" />

    <link rel="stylesheet" href="{% static 'css/app.css' %}" />

    <link rel="stylesheet" href="{% static 'css/base.css' %}" />

    <script defer src="{% static 'scripts/theme.js' %}"></script>
    <script src="{% static 'scripts/mount.js' %}"></script>
    <title>{{site_setting.site_name}} | ورود / ثبت نام</title>
</head>

<body>
    <div
        class="bg-dot-rgba(1,1,1,0.1) dark:bg-dot-rgba(254,254,255,0.1) relative flex min-h-screen w-full items-center justify-center overflow-x-hidden bg-background">
        <div
            class="pointer-events-none absolute inset-0 flex items-center justify-center bg-background [mask-image:radial-gradient(ellipse_at_center,transparent_80%,black)] lg:[mask-image:radial-gradient(ellipse_at_center,transparent_20%,black)]">
        </div>
        <!-- background -->
        <div
            class="pointer-events-none absolute inset-0 flex w-screen items-center justify-center overflow-hidden [mask-image:radial-gradient(transparent_15%,white)]">
            <svg class="absolute left-0 top-0 h-full w-full stroke-black/10 stroke-[2] [mask-image:linear-gradient(transparent_15%,white,transparent_85%)] dark:stroke-white/10"
                data-n-ids='{"1a4MN34vH0:0":"1a4MN34vH0:0"}'>
                <rect width="100%" height="100%" stroke-width="0" fill="url(#grid-pattern-1a4MN34vH0:0)"></rect>
                <svg>
                    <rect stroke-width="0" width="95" height="95" x="97" y="97"
                        class="pointer-events-auto fill-black/5 transition duration-500 hover:fill-black/10 dark:fill-white/5 dark:hover:fill-white/10">
                    </rect>
                    <rect stroke-width="0" width="95" height="95" x="385" y="193"
                        class="pointer-events-auto fill-black/5 transition duration-500 hover:fill-black/10 dark:fill-white/5 dark:hover:fill-white/10">
                    </rect>
                    <rect stroke-width="0" width="95" height="95" x="193" y="289"
                        class="pointer-events-auto fill-black/5 transition duration-500 hover:fill-black/10 dark:fill-white/5 dark:hover:fill-white/10">
                    </rect>
                    <rect stroke-width="0" width="95" height="95" x="673" y="289"
                        class="pointer-events-auto fill-black/5 transition duration-500 hover:fill-black/10 dark:fill-white/5 dark:hover:fill-white/10">
                    </rect>
                    <rect stroke-width="0" width="95" height="95" x="481" y="385"
                        class="pointer-events-auto fill-black/5 transition duration-500 hover:fill-black/10 dark:fill-white/5 dark:hover:fill-white/10">
                    </rect>
                    <rect stroke-width="0" width="95" height="95" x="1249" y="97"
                        class="pointer-events-auto fill-black/5 transition duration-500 hover:fill-black/10 dark:fill-white/5 dark:hover:fill-white/10">
                    </rect>
                    <rect stroke-width="0" width="95" height="95" x="1" y="481"
                        class="pointer-events-auto fill-black/5 transition duration-500 hover:fill-black/10 dark:fill-white/5 dark:hover:fill-white/10">
                    </rect>
                    <rect stroke-width="0" width="95" height="95" x="577" y="481"
                        class="pointer-events-auto fill-black/5 transition duration-500 hover:fill-black/10 dark:fill-white/5 dark:hover:fill-white/10">
                    </rect>
                    <rect stroke-width="0" width="95" height="95" x="1441" y="385"
                        class="pointer-events-auto fill-black/5 transition duration-500 hover:fill-black/10 dark:fill-white/5 dark:hover:fill-white/10">
                    </rect>
                    <rect stroke-width="0" width="95" height="95" x="1057" y="289"
                        class="pointer-events-auto fill-black/5 transition duration-500 hover:fill-black/10 dark:fill-white/5 dark:hover:fill-white/10">
                    </rect>
                    <rect stroke-width="0" width="95" height="95" x="961" y="481"
                        class="pointer-events-auto fill-black/5 transition duration-500 hover:fill-black/10 dark:fill-white/5 dark:hover:fill-white/10">
                    </rect>
                    <rect stroke-width="0" width="95" height="95" x="1249" y="577"
                        class="pointer-events-auto fill-black/5 transition duration-500 hover:fill-black/10 dark:fill-white/5 dark:hover:fill-white/10">
                    </rect>
                </svg>
                <defs>
                    <pattern id="grid-pattern-1a4MN34vH0:0" viewBox="0 0 64 64" width="96" height="96"
                        patternUnits="userSpaceOnUse">
                        <path d="M64 0H0V64" fill="none"></path>
                    </pattern>
                </defs>
            </svg>

            <svg width="1512" height="1714" viewBox="0 0 1512 1714" fill="none" xmlns="http://www.w3.org/2000/svg"
                class="pointer-events-none absolute left-0 top-0 h-auto w-full lg:w-1/2">
                <g clip-path="url(#clip0_143_13)">
                    <g filter="url(#filter0_f_143_13)">
                        <path
                            d="M1045.18 982.551C1129.83 903.957 204.996 477.237 -235.529 294L-339.645 584.211C59.2367 752.376 960.521 1061.15 1045.18 982.551Z"
                            fill="white" fill-opacity="0.15"></path>
                    </g>
                </g>
                <defs>
                    <filter id="filter0_f_143_13" x="-595.645" y="38" width="1902.26" height="1213.13"
                        filterUnits="userSpaceOnUse" color-interpolation-filters="sRGB">
                        <feFlood flood-opacity="0" result="BackgroundImageFix"></feFlood>
                        <feBlend mode="normal" in="SourceGraphic" in2="BackgroundImageFix" result="shape"></feBlend>
                        <feGaussianBlur stdDeviation="64" result="effect1_foregroundBlur_143_13"></feGaussianBlur>
                    </filter>
                    <clipPath id="clip0_143_13">
                        <rect width="1512" height="1714" fill="white"></rect>
                    </clipPath>
                </defs>
            </svg>
        </div>
        <div class="absolute left-2 top-2">
            <button onclick="toggleDark(event)" class="icon-btn h-10 w-10">
                <i class="i-carbon-moon !h-6 !w-6 dark:i-carbon-sun"></i>
            </button>
        </div>

        <div class="z-10 w-full py-10 xs:container">
            <div class="relative mx-auto bg-muted px-4 py-8 xs:max-w-[440px] xs:rounded-xl lg:px-10 lg:py-12">
                <!-- Return previous Section -->
                <a href="#"
                    class="absolute right-2 top-2 flex size-10 items-center justify-center rounded-full border bg-background text-primary duration-300 hover:bg-primary-btn hover:text-background xs:-right-2 xs:-top-2">
                    <i class="i-carbon-chevron-right size-7 stroke-2"></i>
                </a>
                <form method="post" class="flex flex-col" action="{% url 'verify_otp_page' phone %}" id="OTPForm">
                    {% csrf_token %}
                    <!-- Logo -->
                    <a href="{% url 'home_page' %}" class="mb-10">
                        <img src="{{ site_setting.site_logo.url }}" alt="{{ site_setting.site_name }}"
                            class="mx-auto h-10 xs:h-12" />
                    </a>

                    <h1 class="mb-8 text-center font-medium xs:text-lg">
                        کد تایید را وارد کنید
                    </h1>

                    <!-- OTP -->
                    <div class="mb-4 w-full space-y-6">
                        <div id="otp-form" class="flex items-center justify-between gap-x-2" dir="ltr">
                            {{ form.otp_1 }}
                            {{ form.otp_2 }}
                            {{ form.otp_3 }}
                            {{ form.otp_4 }}
                            {{ form.otp_5 }}
                        </div>

                        {% if form.non_field_errors %}
                        {% for error in form.non_field_errors %}
                            <p class="h-5 text-sm text-warning">{{ error }}</p>
                        {% endfor %}
                        {% endif %}


                        {% if messages %}
                            {% for message in messages %}
                            <p class="h-5 text-sm text-warning">{{ message }}</p>
                            {% endfor %}
                        {% endif %}
                    </div>

                    <ul class="mb-6 space-y-4">
                        <li>
                            <p class="text-sm text-primary/60" id="countdownSection">
                                زمان باقی‌مانده تا ارسال مجدد
                                <span id="countdown" class="font-bold">2:00</span>
                            </p>
                            <button id="resendButton" onclick="resendOTP()" class="hidden text-sm text-primary">
                                <span> ارسال مجدد کد تایید </span>
                                <span>
                                    <svg class="h-5 w-5">
                                        <use xlink:href="#chevron-left" />
                                    </svg>
                                </span>
                            </button>
                        </li>
                    </ul>

                    <button type="submit" class="btn-primary py-3">
                        تایید
                    </button>
                </form>
            </div>
        </div>
    </div>
    <script>
        // Time for Resend OTP , Current : 2 minutes
        let countdownMinutes = 2;
        let countdownSeconds = 0;
        let countdownInterval;

        function updateCountdown() {
            const countdownElement = document.getElementById("countdown");
            countdownElement.textContent = `${countdownMinutes}:${countdownSeconds
                .toString()
                .padStart(2, "0")}`;
        }

        function startCountdown() {
            countdownInterval = setInterval(function () {
                if (countdownMinutes === 0 && countdownSeconds === 0) {
                    clearInterval(countdownInterval);
                    document.getElementById("resendButton").classList.remove("hidden");
                    document.getElementById("resendButton").disabled = false;
                    document.getElementById("countdownSection").classList.add("hidden");
                } else {
                    if (countdownSeconds === 0) {
                        countdownMinutes--;
                        countdownSeconds = 59;
                    } else {
                        countdownSeconds--;
                    }
                    updateCountdown();
                }
            }, 1000);
        }

        function resendOTP() {
            if (countdownMinutes != 0 || countdownSeconds != 0) return;
            // Add your OTP resend logic here
            // For demonstration, let's just reset the countdown and disable the button
            countdownMinutes = 2;
            countdownSeconds = 0;
            updateCountdown();
            document.getElementById("resendButton").classList.add("hidden");
            document.getElementById("resendButton").disabled = true;
            document.getElementById("countdownSection").classList.remove("hidden");

            startCountdown();
        }

        startCountdown(); // Start the countdown when the page loads

        // Otp Input Section Start
        const form = document.querySelector("#otp-form");
        const inputs = document.querySelectorAll(".otp-input");

        inputs[0].focus();

        const isAllInputFilled = () => {
            return Array.from(inputs).every((item) => item.value);
        };

        const verifyOTP = () => {
            if (isAllInputFilled()) {
                document.getElementById("OTPForm").submit();
            }
        };

        const toggleFilledClass = (field) => {
            if (field.value) {
                field.classList.add("!border-primary");
            } else {
                field.classList.remove("!border-primary");
            }
        };
        form.addEventListener("input", (e) => {
            const target = e.target;
            const value = target.value;

            toggleFilledClass(target);
            if (target.nextElementSibling) {
                target.nextElementSibling.focus();
            }
            verifyOTP();
        });
        inputs.forEach((input, currentIndex) => {
            // fill check
            toggleFilledClass(input);
            // paste event
            input.addEventListener("paste", (e) => {
                e.preventDefault();
                const text = e.clipboardData.getData("text");

                inputs.forEach((item, index) => {
                    if (index >= currentIndex && text[index - currentIndex]) {
                        item.focus();
                        item.value = text[index - currentIndex] || "";
                        toggleFilledClass(item);
                        verifyOTP();
                    }
                });
            });
            // backspace event
            input.addEventListener("keydown", (e) => {
                if (e.keyCode === 8) {
                    e.preventDefault();
                    input.value = "";
                    // console.log(input.value);
                    toggleFilledClass(input);
                    if (input.previousElementSibling) {
                        input.previousElementSibling.focus();
                    }
                } else {
                    if (input.value && input.nextElementSibling) {
                        input.nextElementSibling.focus();
                    }
                }
            });
        });

        // Otp Input Section End
    </script>
</body>

</html>